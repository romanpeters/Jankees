---
- name: Add user jenkins
  ansible.builtin.user:
    name: jenkins
    state: present
    password: '!'

- name: Add jenkins to authorized hosts
  ansible.posix.authorized_key:
    user: jenkins
    state: present
    key: "{{ hostvars['jenkins']['jenkins_ssh_key'] }}"

- name: Add passwordless sudo
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    state: present
    create: true
    mode: 0440
    line: "jenkins		ALL=(ALL:ALL) NOPASSWD:ALL"
    validate: /usr/sbin/visudo -cf %s

